<!doctype html>
<html class="theme-next use-motion theme-next-next">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>




  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.0"/>




	<meta name="keywords" content="Three.js,教程," />

  <title> 第一章:用three.js创造你的第一个3D场景 // 视觉极客 </title>
</head>

<body>
  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">视觉极客</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>


  <ul id="menu" class="menu">
    
      
      <li class="menu-item menu-item-home">
        <a href="/">
          <i class="menu-item-icon icon-home"></i> <br />
          首页
        </a>
      </li>
    
      
      <li class="menu-item menu-item-categories">
        <a href="/categories">
          <i class="menu-item-icon icon-categories"></i> <br />
          分类
        </a>
      </li>
    
      
      <li class="menu-item menu-item-archives">
        <a href="/archives">
          <i class="menu-item-icon icon-archives"></i> <br />
          归档
        </a>
      </li>
    
      
      <li class="menu-item menu-item-tags">
        <a href="/tags">
          <i class="menu-item-icon icon-tags"></i> <br />
          标签
        </a>
      </li>
    
      
      <li class="menu-item menu-item-about">
        <a href="/about">
          <i class="menu-item-icon icon-about"></i> <br />
          关于
        </a>
      </li>
    
  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
            
          

          <div id="posts" class="posts-expand">
            
  

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              第一章:用three.js创造你的第一个3D场景
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2015-02-04
          
        </span>

        
          
            <span class="post-category">
              &nbsp; | &nbsp; 分类于
              
                <a href="/categories/Three-js/">Three.js</a>

                
                

              
            </span>
          
        

        
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          <p>现代的浏览器有了越来越多牛逼的特性，javascript在这其中起着非常重要的作用。你能用新的HTML5标签(video、audio)简单地添加视频和音频，或者用canvas绘制创建可交互对象。另外一个不得不说的新功能就是对WebGL的支持。WebGL能让你直接调用显卡进程资源创造高品质的2D或者3D图形。<br><a id="more"></a><br>直接用javascript进行WebGL编程非常复杂，Three.js将WebGL进行了封装，让这一切变简单的库。下面的列表展示了Three.js简化webGL编程的几个方面：</p>
<ul>
<li>创建简单或复杂的3d几何图形</li>
<li>为3D场景中对象添加动画效果</li>
<li>给3D对象添加材质和纹理</li>
<li>载入来自3D建模软件（MAYA,Blender,3DS MAX等）的模型</li>
<li>创建2D sprite-based 图形</li>
</ul>
<p>只需要数行的javascript代码，你就能创建简单的3D模型或者如下所示的逼真的实时场景:</p>
<p><img src="http://ww2.sinaimg.cn/large/b29e5633tw1eox57t03jwj20s60kkwk7.jpg" alt=""></p>
<p>在第一章中，我们将直入Three.js主题并且创建一些实例来向你展示Three.js是如何工作的，而且你还能通过控制菜单来操控这些实例。我们暂时不会深究所有的技术细节，那将在以后的章节中学习到。</p>
<h3 id="第一章涉及的内容如下：">第一章涉及的内容如下：</h3><ul>
<li>为Three.js准备工具</li>
<li>下载本书所用的源代码</li>
<li>创造你的第一个3D场景(scene)</li>
<li>从材质（materials）、灯光（lights）、和动画（animations）方面升级你的第一个3D场景</li>
<li>介绍几个检测FPS或者操控场景的辅助JS库</li>
</ul>
<p>我们将以对Three.js的简单介绍作为本书的开始，然后快速进入第一个例子的学习，并且编写些简单代码。在我们开始之前，让我们看一下几个当下流行的浏览器和他们对WebGL的支持。</p>
<h5 id="目前有以下浏览器能够很好地支持Three-js">目前有以下浏览器能够很好地支持Three.js</h5><ul>
<li>火狐(Mozilla Firefox):从4.0版开始支持</li>
<li>chrome：从V9开始支持</li>
<li>Safari：从5.1版本开始支持。需要手动在浏览器中启用的WebGL(首先在菜单栏中点Safari&gt;偏好设置&gt;高级&gt;勾选“在菜单栏               显示‘开发菜单’”，然后点击菜单栏中开发&gt;启用WebGL)</li>
<li>Opera：从12.00版本开始支持，不过同样需要手动启用</li>
<li>IE：很长时间以来IE都是唯一一个不支持WebGL的主流浏览器，不过从IE11开始，微软为它添加了这个功能:)</li>
</ul>
<p>基本上，Three.js能在任何现代浏览器中运行，如果你想使用没有WebGL功能的IE浏览器老版本，有两种办法：①使用谷歌浏览器内嵌框架来获得WebGL支持，你可以从这里下载：<a href="https://developers.google.com/chrome/chrome-frame/" target="_blank" rel="external">https://developers.google.com/chrome/chrome-frame/</a>。②您还可以使用iewebgl插件，你可以从<a href="http://iewebgl.com/" target="_blank" rel="external">http://iewebgl.com/</a>获得。它会安装在IE里来支持WebGL</p>
<pre><code>Google已经官方地放弃了Google Chrome <span class="keyword">Frame</span>的更新支持，它不支持IE10和<span class="number">10</span>之后的IE版本

现在开发维护Three.js的家伙们正在正在创造基于CSS-<span class="number">3</span><span class="keyword">D</span>规范的新的渲染器，将会支持大量的浏览器（甚至IE10）。除了桌面浏览器，许多移动端浏览器也支持CSS-<span class="number">3</span><span class="keyword">D</span>。
</code></pre><p>在本章中，你将直接创建你的第一个3D场景，很多复杂的Three.js的特性我们暂时先不详细解释，本章会创建的3D场景入下</p>
<p><img src="http://ww4.sinaimg.cn/large/b29e5633tw1eoxi30yhndj20y00kyjtq.jpg" alt=""></p>
<p>通过这个简单的例子你能学到Three.js的很多基础知识，包括创建动画效果。在开始之前，我们先来介绍几个能让你事半功倍的给力工具，还有怎样下载本书的示例代码。</p>
<h3 id="使用Three-js的要求">使用Three.js的要求</h3><p>Three.js是一个JavaScript库，所以要创建Three.js应用你只需要一个文本编辑器和渲染结果的浏览器就行了。</p>
<h5 id="文本编辑器：">文本编辑器：</h5><ul>
<li>WebStorm（需要购买或者破解）</li>
<li>Notepad++（仅支持windows）</li>
<li>Sublime Text</li>
</ul>
<p>即使你不喜欢上面的三款编辑器，还有海量的开源或者商业软件供你选择。还有一个你可能感兴趣的项目是<a href="http://c9.io" target="_blank" rel="external">http://c9.io</a>,这是一个云js编辑器，你可以用GitHub账号登陆。<br>我之前提到过大多数现代浏览器支持WebGL，我习惯用的是Chrome，原因是大多数情况下，Chrome浏览器能最好地支持WebGL，并且性能极佳。它有一个很棒的JavaScript调试器，有了这个调试器，你可以通过使用断点和控制台输出来快速查明问题。在这本书中，我也会讲到调试器的使用和一些调试查错技巧。</p>
<p><img src="http://ww2.sinaimg.cn/large/b29e5633gw1eoxiqj4vubj20ym0kigt4.jpg" alt=""></p>
<h3 id="获取本书示例的源码">获取本书示例的源码</h3><p>本书所有的源码都能在github下载的到。<a href="https://github.com/josdirksen/learning-threejs" target="_blank" rel="external">https://github.com/josdirksen/learning-threejs</a></p>
<p>安装一个文本编辑器，下载好本书需要的源代码，接下来就可以开始创建我们的Three.js场景了。</p>
<h3 id="创建一个HTML框架页面">创建一个HTML框架页面</h3><p>我们要做的第一件事，就是创建一个空的HTML框架页面来作为所有示例的基础。页面如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;!DOCTYPE html&#62;&#10;   &#60;html&#62;&#10;     &#60;head&#62;&#10;       &#60;title&#62;Example 01.01 - Basic skeleton&#60;/title&#62;&#10;       &#60;script type=&#8220;text/javascript&#34;&#10;&#9;src=&#34;../libs/three.js&#34;&#62;&#60;/script&#62;&#10;    &#60;script type=&#34;text/javascript&#34;&#10;             src=&#34;../libs/jquery-1.9.0.js&#34;&#62;&#60;/script&#62;&#10;    &#60;style&#62;&#10;        body&#123;&#10;            /* &#35774;&#32622; margin &#20026; 0 &#65292; overflow &#20026; hidden,&#10;               &#36825;&#26679;&#23601;&#33021;&#24471;&#21040;&#28385;&#23631;&#30340;&#39029;&#38754;&#20102; */&#10;            margin: 0;&#10;            overflow: hidden;&#10;        &#125;&#10;    &#60;/style&#62;&#10;  &#60;/head&#62;&#10;&#60;body&#62;&#10;&#60;!-- &#20316;&#20026;&#28210;&#26579;&#32467;&#26524;&#36755;&#20986;&#30340;Div --&#62;&#10;&#60;div id=&#34;WebGL-output&#34;&#62;&#10;&#60;/div&#62;&#10;&#60;!-- Three.js&#20363;&#23376;&#30340;js&#20195;&#30721; --&#62;&#10;    &#60;script type=&#34;text/javascript&#34;&#62;&#10;    // &#24403;&#25152;&#26377;&#25991;&#20214;&#21152;&#36733;&#22806;&#21518;&#24320;&#22987;&#25191;&#34892;Three.js&#30340;&#20195;&#30721;&#10;    $(function () &#123;&#10;          // &#22312;&#36825;&#37324;&#25918;&#32622;Three.js&#30340;&#20195;&#30721;&#10;    &#125;);&#10;    &#60;/script&#62;&#10;  &#60;/body&#62;&#10;&#60;/html&#62;</span><br></pre></td></tr></table></figure></p>
<p>可以看出来，框架是一个非常简单的HTML页面，仅有几个元素，<head>元素中我们将加载例子中会用到的外部的js库，对于所有的示例来说，我们至少要加载两个库：Three.js和jQuery.js。在<head>元素中我们也添加了几行CSS,这些样式移除了创建全屏Three.js场景时烦人的滚动条。在</head></head><body>中只有一个<div>,当我们写Three.js代码时，会把Three.js渲染器的输出指向这个div元素。在之前的代码预览中，你已经看到了一小撮js，那几行代码用了jQuery,在页面加载完毕的时候会调用一个匿名函数。我们将把所有的Three.js代码放置在这个匿名函数里。</div></body></p>
<p>如果我们现在浏览这个页面，你能看到的结果如译者内心一样洁白无暇。<br>下一小节，你将学到如何添加3D对象和如何将他们渲染输出到框架页面中定义的DIV里。</p>
<h3 id="渲染浏览一个3D对象">渲染浏览一个3D对象</h3><p>在这一步中，你将创建第一个场景（scene）并且添加一些3D 对象（objects）和一个摄像机（camera）。</p>
<p>我们第一个例子将会包含如下对象：</p>
<ul>
<li>plane（平面）：一个二维矩形作为我们的背景区域，他会渲染成一个灰色矩形，位于场景(scene)中间</li>
<li>Cube（立方体）:一个三维立方体，就决定是红色的啦</li>
<li>Sphere（球体）：一个3D球体，蓝色最好不过啦</li>
<li>Camera（摄像机）：摄像机（camera）决定了你将看到怎样的结果</li>
<li>Axes（坐标轴）：xyz轴，能帮我们了解3D对象渲染到了哪里，也是很棒的查错工具<br>我们先来看看代码是什么样子的，然后再来慢慢解释</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script type=&#34;text/javascript&#34;&#62;&#10;       $(function () &#123;&#10;           var scene = new THREE.Scene();&#10;           var camera = new THREE.PerspectiveCamera(45&#10;                                , window.innerWidth / window.innerHeight&#10;, 0.1, 1000);&#10;           var renderer = new THREE.WebGLRenderer();&#10;           renderer.setClearColorHex(0xEEEEEE);&#10;           renderer.setSize(window.innerWidth, window.innerHeight);&#10;           var axes = new THREE.AxisHelper( 20 );&#10;           scene.add(axes);&#10;           var planeGeometry = new THREE.PlaneGeometry(60,20,1,1);&#10;           var planeMaterial = new THREE.MeshBasicMaterial(&#10;                                             &#123;color: 0xcccccc&#125;);&#10;           var plane = new THREE.Mesh(planeGeometry,planeMaterial);&#10;           plane.rotation.x=-0.5*Math.PI;&#10;plane.position.x = 15;&#10;           plane.position.y = 0;&#10;           plane.position.z = 0;&#10;           scene.add(plane);&#10;           var cubeGeometry = new THREE.CubeGeometry(4,4,4);&#10;           var cubeMaterial = new THREE.MeshBasicMaterial(&#10;                             &#123;color: 0xff0000, wireframe: true&#125;);&#10;           var cube = new THREE.Mesh(cubeGeometry, cubeMaterial);&#10;           cube.position.x = -4;&#10;           cube.position.y = 3;&#10;           cube.position.z = 0;&#10;           scene.add(cube);&#10;           var sphereGeometry = new THREE.SphereGeometry(4,20,20);&#10;           var sphereMaterial = new THREE.MeshBasicMaterial(&#10;                                  &#123;color: 0x7777ff, wireframe: true&#125;);&#10;           var sphere = new THREE.Mesh(sphereGeometry,sphereMaterial);&#10;           sphere.position.x = 20;&#10;           sphere.position.y = 4;&#10;           sphere.position.z = 2;&#10;           scene.ad&#65532;d(sphere);&#10;           camera.position.x = -30;&#10;           camera.position.y = 40;&#10;           camera.position.z = 30;&#10;           camera.lookAt(scene.position);&#10;           $(&#34;#WebGL-output&#34;).append(renderer.domElement);&#10;           renderer.render(scene, camera);&#10;       &#125;);&#10;&#10;&#60;/script&#62;</span><br></pre></td></tr></table></figure>
<p>现在打开这个页面，我们会看到一些和我们的目标相近的东西，但是还有很多事情要做。</p>
<p><img src="http://ww1.sinaimg.cn/large/b29e5633tw1eoxiwb0ov5j20yg0kewgr.jpg" alt=""></p>
<p>在我们开始把这个场景弄得美美的之前，我们先来解释一下上面的代码<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var scene = new THREE.Scene();&#10;   var camera = new THREE.PerspectiveCamera(45&#10;                            , window.innerWidth / window.innerHeight&#10;, 0.1, 1000);&#10;   var renderer = new THREE.WebGLRenderer();&#10;   renderer.setClearColorHex(0xEEEEEE);&#10;   renderer.setSize(window.innerWidth, window.innerHeight);</span><br></pre></td></tr></table></figure></p>
<p>在上面的例子中，我们定义了一个场景（scene），摄像机（camera）和一个渲染器（renderer），scene变量是一个存储所有的我们要渲染的对象的容器。我们想渲染的球体和立方体会稍后添加进场景。在上面代码中，我们也创建了一个camera摄像机变量，摄像机变量决定了当我们渲染场景时我们将看到什么。在第二章（用基础元素组合Three.js场景）中你会学到摄像机的更多参数。然后，我们还有定义一个renderer渲染器对象，它能基于摄像机的视角渲染场景。我们在示例中创建的是一个WebGLRenderer对象，它能用你的显卡去渲染场景。</p>
<pre><code>如果你看一下<span class="tag">Three</span><span class="class">.js</span>的源代码或者文档，你会发现有多重不同的渲染器，除了基于<span class="tag">WebGL</span>的渲染器外，还有基于<span class="tag">canvas</span>甚至基于<span class="tag">svg</span>的。后两者可以渲染些简单的场景，我不建议使用它们，它们都是<span class="tag">CPU</span>密集型的，还缺少对材质、阴影的支持
</code></pre><p>这里我们还使用了setClearColorHex()函数把渲染器renderer的背景颜色设置成了近乎白色(0XEEEEEE)，并且还用到了setSize()函数,它的作用显然是告诉渲染器需要把场景渲染成多大的。</p>
<p>现在呢，我们已经得到了一个基础的空的场景（scene），一个渲染器（renderer）和一个摄像机（camera），然而，并没有3D对象被渲染，下面的代码就添加了辅助坐标轴（helper axes）和平面（plane）</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var axes = new THREE.AxisHelper( 20 );&#10;   scene.add(axes);&#10;   var planeGeometry = new THREE.PlaneGeometry(60,20);&#10;   var planeMaterial = new THREE.MeshBasicMaterial(&#10;                                         &#123;color: 0xcccccc&#125;);&#10;   var plane = new THREE.Mesh(planeGeometry,planeMaterial);&#10;   plane.rotation.x = -0.5*Math.PI;&#10;   plane.position.x = 15;&#10;   plane.position.y = 0;&#10;   plane.position.z = 0;&#10;   scene.add(plane);</span><br></pre></td></tr></table></figure>
<p>很容易看出来，我们创建了一个axes对象然后用scene.add()函数添加进我们的场景（scene）<br>然后是平面（plane），虽然代码看起来很多，实际上可以分为以下两步：<br>首先，用THREE.PlaneGeometry(60,20)来定义平面的尺寸——宽60高20<br>我们也需要告诉Threejs平面的其他表现特征（例如颜色、透明度）。在threejs中我们通过创建一个材质对象来实现以上需求<br>在这个例子中我们创建了一个基础材质（通过MeshBasicMaterial()方法），颜色是0xcccccc<br>下一步，我们将它俩（几何体&amp;材质）组合进一个Mesh对象，取名为plane，在我们把plane添近scene之前需要把它放在合适的位置，本例中，仅仅是将它绕x轴旋转九十度。最后一步就是将平面添加进场景，就跟添加坐标轴的步骤一样。</p>
<pre><code>如果你对<span class="tag">Mesh</span>对象感性，可以先看看第二章中的06<span class="tag">-mesh-properties</span><span class="class">.html</span>示例。
</code></pre><p>立方体和球体的添加方式也大同小异，只是将wireframe属性（线框属性）设置为true。我们现在来看下示例代码的最后部分：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">camera.position.x = -30;&#10;camera.position.y = 40;&#10;camera.position.z = 30;&#10;camera.lookAt(scene.position);&#10;$(&#34;#WebGL-output&#34;).append(renderer.domEleme</span><br></pre></td></tr></table></figure></p>
<p>目前为止，我们想渲染的所有对象已经都添加进了场景里面，并且摆在了正确的位置，上文说过，camera决定了什么会被渲染，上面一小撮代码中，我们通过xyz位置参数放置了camera，让他悬在scene上面俯瞰我们制造的这个世界。为了确保camera正朝着我们的物体，我们用lookAt()函数来使它的镜头对准scene的中心。唯一还没有做的就是把renderer所输出的添加到div中，我们使jQuery来选择合适的输出元素，并且告诉renderer用提供的camera渲染场景。</p>
<p>本章下一个小节，我们将通过添加灯光（lights）、材质（materials）和动画效果（animations）让scene变得更好看</p>
<h3 id="添加材质、灯光和阴影">添加材质、灯光和阴影</h3><p>添加新的材质（material）和灯光（lights）对于threejs来说是很简单的，并且方法和之前小节介绍的相似，我们先来给创造的第一个场景添加一个光源吧。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var spotLight = new THREE.SpotLight( 0xffffff );&#10;spotLight.position.set( -40, 60, -10 );&#10;scene.add( spotLight );</span><br></pre></td></tr></table></figure>
<p>SpotLight()方法让一个点光源从他的位置照着我们的场景，他的位置是这样定义的：spotLight. position.set( -40, 60, -10 )。如果我们现在打开这个页面，你根本不会看到任何变化。原因是不同的材质对光源的反射是不同的。我们之前选用的基础材质（MeshBasicMaterial()）是一种神秘神奇的材质，任何光源都对效。它只是将对象渲染成特定的颜色，所以我们必须为我们的立方体、平面和球体换一种材质，代码如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var planeGeometry = new THREE.PlaneGeometry(60,20);&#10;var planeMaterial = new THREE.MeshLambertMaterial(&#10;                                      &#123;color: 0xffffff&#125;);&#10;var plane = new THREE.Mesh(planeGeometry,planeMaterial);&#10;...&#10;var cubeGeometry = new THREE.CubeGeometry(4,4,4);&#10;var cubeMaterial = new THREE.MeshLambertMaterial(&#10;                                      &#123;color: 0xff0000&#125;);&#10;var cube = new THREE.Mesh(cubeGeometry, cubeMaterial);&#10;...&#10;var sphereGeometry = new THREE.SphereGeometry(4,20,20);&#10;var sphereMaterial = new THREE.MeshLambertMaterial(&#10;                                      &#123;color: 0x7777ff&#125;);&#10;var sphere = new THREE.Mesh(sphereGeometry,sphereMaterial);</span><br></pre></td></tr></table></figure></p>
<p>这样我们就将材质换成了MeshLambertMaterial。事实上threejs提供了两种对光照不会性冷淡的材质：</p>
<ul>
<li>MeshLambertMaterial  </li>
<li>MeshPhongMaterial</li>
</ul>
<p>现在呈现的效果应该是这样的，不过，仍然不能满足我们追求完美的心</p>
<p><img src="http://ww3.sinaimg.cn/large/b29e5633tw1eoxk2dknkmj20y00kyjtq.jpg" alt=""></p>
<p>目前位置，立方体和球体看起来好一点了，不过有光照怎么能没有影子呢？<br>需要注意的是渲染阴影会花费很多电脑资源，所以threejs默认关闭阴影效果。<br>开启阴影效果很简单，我们只需要修改两个地方就可以。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">renderer.setClearColorHex(0xEEEEEE, 1.0);&#10;renderer.setSize(window.innerWidth, window.innerHeight);&#10;renderer.shadowMapEnabled = true;</span><br></pre></td></tr></table></figure>
<p>第一个改动：告诉渲染器renderer我们对阴影已经饥渴难耐，把shadowMapEnabled属性设置成true就行了。如果你现在就查看结果会发现什么都没有改变，这是因为还需要明确的定义哪些物体投射（cast）阴影那些物体接受/承受（receive）阴影。<br>比如说，在我们的示例中，我们想让球体(sphere)和立方体(cube)的阴影投射到平面(plane)上，你可以通过把这些物体的相应属性设置成true来实现</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plane.receiveShadow = true;&#10;&#10;cube.castShadow = true;&#10; &#10;sphere.castShadow = true;</span><br></pre></td></tr></table></figure>
<p>现在，你仅需一步就能得到口耐的阴影了。那就是定义哪个光源会产生阴影，不是所有的光都能产生阴影，下面的章节我们还会详细介绍。总而言之，我们的小点光源SpotLight()是属于能够产生阴影的。我们只需要设置正确的属性阴影就能出现了</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spotLight.castShadow = true;</span><br></pre></td></tr></table></figure>
<p>终于终于，我们得到了一个有阴影的3D场景</p>
<p><img src="http://ww2.sinaimg.cn/large/b29e5633tw1eoxkb0xkigj20y00kyjtq.jpg" alt=""></p>
<p>我们要做的最后一件事是给这个场景添加简单的动画效果。在第九章中我们会对此有更深入的学习</p>
<h3 id="用动画丰富第一个3D场景">用动画丰富第一个3D场景</h3><p>如果你想让你的scene动起来，需要做的第一件事就是找到以特定时间间隔重渲染场景的方法。在HTML5和相关的 JavaScript API出现之前，实现方式是用setInterval(function,interval)函数。用SetInterval()，我们能让一个函数隔特定的时间循环执行。但是问题是这个函数不能对浏览器状态改变作出响应。如果你去浏览另一个同时打开的页面，之前页面中这个函数仍然会执行，除此之外,setInterval()不能和屏幕重绘同步.这会导致更高的CPU使用和糟糕的3D表现效果</p>
<h5 id="介绍requestAnimationFrame()方法">介绍requestAnimationFrame()方法</h5><p>现代浏览器对setInterval()函数的相关问题有了解决方案：requestAnimationFrame()函数。用requestAnimationFrame()函数你能让一个函数按指定的时间间隔执行。你能通过它提供的功能画你所画，并且浏览器能让这一切流畅而高效。它的用法非常简单，你只需要创建一个处理渲染的函数：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function renderScene() &#123;&#10;     requestAnimationFrame(renderScene);&#10;     renderer.render(scene, camera);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>在renderScene函数中，我们调用了requestAnimationFrame()，并且在一次调用了renderScene()函数本身，这就能让动画效果持续了。我们唯一需要改动的就是在我们创建完整场景后不是调用renderer.render()而是调用renderScene()来开始动画。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(&#34;#WebGL-output&#34;).append(renderer.domElement);&#10;     renderScene();</span><br></pre></td></tr></table></figure>
<p>修改完毕后运行，你不会看到任何变化，因为我们没有添加任何动画效果。在我们添加动画之前，我想介绍一个小小的辅助工具，他能告诉我们动画的帧率，值得一提的是，他是threejs同一作者编写的。他能渲染一个显示动画fps的小图像</p>
<p>我们需要在<head>标签中引入库文件</head></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script type=&#34;text/javascript&#34; src=&#34;../libs/stats.js&#34;&#62;&#60;/script&#62;</span><br></pre></td></tr></table></figure>
<p>然后添加一个div作为statistics graph的输出</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;div id=&#34;Stats-output&#34;&#62;&#60;/div&#62;</span><br></pre></td></tr></table></figure>
<p>最后一步：初始化辅助工具statistic并且添加到作为输出地div</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> function initStats() &#123;&#10;               var stats = new Stats();&#10;               stats.setMode(0);&#10;               stats.domElement.style.position = &#39;absolute&#39;;&#10;               stats.domElement.style.left = &#39;0px&#39;;&#10;               stats.domElement.style.top = &#39;0px&#39;;&#10;               $(&#34;#Stats-output&#34;).append( stats.domElement );&#10;               return stats;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>这个函数初始化了statistic。最有趣的要数setMode()函数了。如果我们设置为0，我们能测算FPS,如果设置为1，我们能测算渲染时间（rendering time）。本示例中我们要测算的是FPS。所以stats.setMode(0)。在匿名函数的最开头部分，我们可以调用这个初始化函数让他生效<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(function () &#123;&#10;           var stats = initStats();&#10;           //&#20854;&#20182;threejs&#20195;&#30721;&#8230;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>还有一件事需要做，那就是告诉stats对象何时会开始新的下渲染周期。为此我们得把stats.updata()方法添加到render函数中<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function render() &#123;&#10;               stats.update();&#10;               ...&#10;               requestAnimationFrame(render);&#10;               renderer.render(scene, camera);&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果你运行添加完毕后的代码，会在左上角看到传说中的FPS<br><img src="http://ww4.sinaimg.cn/large/b29e5633tw1eoxku8xpaej20y00kyjtq.jpg" alt=""></p>
<h3 id="让立方体动起来">让立方体动起来</h3><p>通过配置requestAnimationFrame()方法和statistic，我们已经得到了一个添加动画代码的好胚子。本小节我们将扩展render()函数，加入让立方体旋转的代码。老规矩，先上代码：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function render() &#123;&#10;               ...&#10;               cube.rotation.x += 0.02;&#10;               cube.rotation.y += 0.02;&#10;               cube.rotation.z += 0.02;&#10;               ...&#10;               requestAnimationFrame(render);&#10;               renderer.render(scene, camera);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>看起来很简单对吗？我们让cube每个坐标轴的角度在每次渲染时都增加0.02度。现在我们能在浏览器中看到一个流畅旋转的立方体。同理，让蓝色球体弹跳也不难。</p>
<h3 id="让球体弹跳起来">让球体弹跳起来</h3><p>为了给球体添加弹跳的动画效果，我们在render函数中增加下面几行代码：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var step=0;&#10;function render() &#123;&#10;             ...&#10;             step+=0.04;&#10;             sphere.position.x = 20+( 10*(Math.cos(step)));&#10;             sphere.position.y = 2 +( 10*Math.abs(Math.sin(step)));&#10;             ...&#10;             requestAnimationFrame(render);&#10;             renderer.render(scene, camera);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>我们改变了立方体（cube）的rotation（角度）属性，对于球体（sphere）我们要改变它的位置属性。我们想让sphere沿美丽平滑的曲线从一个点弹跳到另一个点。<br>我们需要改变它xy轴的位置属性，Math.cos()和Math.sin()函数帮助我们通过step变量创建平滑的轨道。我们现在先不深入研究cos、sin和step的作用关系，接下来在第八章中我们会深入的讲解，现在你只需要知道step+=0.04定义了球体弹跳的速度就好了，现在运行你看到球体欢乐地跳动了起来<br><img src="http://ww4.sinaimg.cn/large/b29e5633tw1eoxl8kn3xoj20yc0kc76e.jpg" alt=""></p>
<h3 id="用dat-GUI库让调试变得易如反掌">用dat.GUI库让调试变得易如反掌</h3><p>google的一些家伙们创造了一个叫dat.GUI 的库。它允许你创建一个简单的用户交互对象，用来改变后台代码中的变量。本小节，我们将用dat.GUI来给示例添加一个用户交互功能实现以下效果<br>控制球弹跳的速度和立方体旋转的角度<br>先引入库文件</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;script type=&#34;text/javascript&#34; src=&#8220;../libs/dat.gui.js&#34;&#62;&#60;/script&#62;</span><br></pre></td></tr></table></figure>
<p>然后需要设置的是一个js 对象，它能控制我们想通过GUI改变的属性。在我们主要的js代码中，我们需要添加如下js对象：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var controls = new function() &#123;&#10;&#9;&#9;               this.rotationSpeed = 0.02;&#10;&#9;&#9;               this.bouncingSpeed = 0.03;&#10;        &#125;</span><br></pre></td></tr></table></figure>
<p>在这个js对象中定义了两个属性：this.ratationSpeed和this.bounceSpeed,并且初始了默认值。然后，我们将把这个对象传递进一个新的dat.GUI对象:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var gui = new dat.GUI();&#10;gui.add(controls, &#39;rotationSpeed&#39;,0,0.5);&#10;gui.add(controls, &#39;bouncingSpeed&#39;,0,0.5);</span><br></pre></td></tr></table></figure>
<p>rotationSpeed和bounceSpeed属性都被设置了0到0.5的变化范围。在渲染循环中直接引用这两个属性，就能通过前端控制菜单，就能控制立方体和球体动画执行的参数了。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function render() &#123;&#10;  ...&#10;  cube.rotation.x += controls.rotationSpeed;&#10;  cube.rotation.y += controls.rotationSpeed;&#10;  cube.rotation.z += controls.rotationSpeed;&#10;  step+=controls.bouncingSpeed;&#10;  sphere.position.y = 2 +( 10*Math.abs(Math.sin(step)));&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在当你运行的时候你将看到一个能控制跳动和旋转速度的简单的ui界面</p>
<p><img src="http://ww2.sinaimg.cn/large/b29e5633tw1eoxlk4tg1fj20ye0k276j.jpg" alt=""></p>
<h3 id="使用ASCII效果">使用ASCII效果</h3><p>经过本章的学习，我们已经利用最先进的浏览器特性创建了一个漂亮的3D渲染图像。threejs也有很多改变输出渲染的有趣特性。在结束本章前，我想介绍其中的一个特性：ASCII效果。通过ASDII效果你能改变我们美腻的动画场景成一个复古的ASCII艺术动画。这只需要几行代码。<br>找到如下代码：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(&#34;#WebGL-output&#34;).append(renderer.domElement);</span><br></pre></td></tr></table></figure>
<p>替换成如下代码</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var effect = new THREE.AsciiEffect( renderer );&#10;effect.setSize( window.innerWidth, window.innerHeight );&#10;$(&#34;#WebGL-output&#34;).append(effect.domElement);</span><br></pre></td></tr></table></figure>
<p>你也必须小小改变一下渲染循环。替换掉renderer.render(scene, camera)，改用effect.render(scene,camera)<br>最终效果如下：</p>
<p>我必须承认这并不是非常有用，但是它很好地展现了threejs的各个部分都非常易于扩展，因为它是模块化的。</p>
<p><img src="http://ww3.sinaimg.cn/large/b29e5633tw1eoxlsnvyf4j20yc0mo0xq.jpg" alt=""></p>
<h3 id="总结">总结</h3><p>如上就是开山辟地的第一章。在本章中你已经学会了创造threejs场景的多方面的知识。这会给你以后的学习开一个好头。有下面一些内容你需要牢记</p>
<ul>
<li>你能在网上找到本书所有的源代码，最好地学习方式就是把示例弄得一清二楚<br>-</li>
<li>在threejs中你需要创建场景来添加想渲染的对象（几何体和材质的组合）</li>
<li>材质决定你的物体长什么模样，不同材质对光的反应效果不同</li>
<li>渲染阴影是奢侈的，你需要打开阴影效果——不仅是物体，也包括光源</li>
<li>你能通过改变物体的角度rotation和位置position属性创建简单的动画</li>
<li>通过两个辅助库能容易地为场景添加上统计和控制功能</li>
</ul>
<h5 id="下一章中我们会拓展本章的示例，你将学到更多threejs知识。">下一章中我们会拓展本章的示例，你将学到更多threejs知识。</h5>
        
      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/Three-js/">
                #Three.js
              </a>
            
              <a href="/tags/教程/">
                #教程
              </a>
            
          </div>
        

        
          <div class="post-nav">
            <div class="post-nav-prev post-nav-item">
              
                <a href="/2015/02/05/c2/">第二章:用基本组件搭建Three.js场景(part 1)</a>
              
            </div>

            <div class="post-nav-next post-nav-item">
              
                <a href="/2015/02/03/杂/">杂</a>
              
            </div>
          </div>
        

        
        
      </div>
    
  </div>



  
    <div class="comments" id="comments">
      
    </div>
  

          </div>

          
        </div>

        
<div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>

<div id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    
      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
          文章目录
        </li>
        <li class="sidebar-nav-overview" data-target="site-overview">
          站点概览
        </li>
      </ul>
    

    <div class="site-overview">
      <div class="site-author motion-element">
        <img class="site-author-image" src="/images/default_avatar.jpg" alt="visgee" />
        <p class="site-author-name">visgee</p>
      </div>
      <p class="site-description motion-element"></p>
      <div class="site-state motion-element">
        <div class="site-state-item site-state-posts">
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">日志</span>
        </div>
        <div class="site-state-item site-state-tags">
            <span class="site-state-item-count">4</span>
            <span class="site-state-item-name">标签</span>
        </div>
        <div class="site-state-item site-state-pages">
            <span class="site-state-item-count">2</span>
            <span class="site-state-item-name">页面</span>
        </div>
      </div>

      

      <div class="links-of-author motion-element">
        
          
            <span class="links-of-author-item">
              <a href="your-github-url">GitHub</a>
            </span>
          
            <span class="links-of-author-item">
              <a href="your-twitter-url">Twitter</a>
            </span>
          
            <span class="links-of-author-item">
              <a href="your-weibo-url">Weibo</a>
            </span>
          
            <span class="links-of-author-item">
              <a href="your-douban-url">DouBan</a>
            </span>
          
            <span class="links-of-author-item">
              <a href="your-zhihu-url">ZhiHu</a>
            </span>
          
        
      </div>

      
      
        <div class="cc-license motion-element">
          <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
            <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
          </a>
        </div>
      

    </div>

    
      <div class="post-toc-wrap sidebar-panel-active">
        <div class="post-toc-indicator-top post-toc-indicator"></div>
        <div class="post-toc">
          
          
            <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#第一章涉及的内容如下："><span class="nav-number">1.</span> <span class="nav-text">第一章涉及的内容如下：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#目前有以下浏览器能够很好地支持Three-js"><span class="nav-number">1.0.1.</span> <span class="nav-text">目前有以下浏览器能够很好地支持Three.js</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用Three-js的要求"><span class="nav-number">2.</span> <span class="nav-text">使用Three.js的要求</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#文本编辑器："><span class="nav-number">2.0.1.</span> <span class="nav-text">文本编辑器：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取本书示例的源码"><span class="nav-number">3.</span> <span class="nav-text">获取本书示例的源码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建一个HTML框架页面"><span class="nav-number">4.</span> <span class="nav-text">创建一个HTML框架页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#渲染浏览一个3D对象"><span class="nav-number">5.</span> <span class="nav-text">渲染浏览一个3D对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加材质、灯光和阴影"><span class="nav-number">6.</span> <span class="nav-text">添加材质、灯光和阴影</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用动画丰富第一个3D场景"><span class="nav-number">7.</span> <span class="nav-text">用动画丰富第一个3D场景</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#介绍requestAnimationFrame()方法"><span class="nav-number">7.0.1.</span> <span class="nav-text">介绍requestAnimationFrame()方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#让立方体动起来"><span class="nav-number">8.</span> <span class="nav-text">让立方体动起来</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#让球体弹跳起来"><span class="nav-number">9.</span> <span class="nav-text">让球体弹跳起来</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用dat-GUI库让调试变得易如反掌"><span class="nav-number">10.</span> <span class="nav-text">用dat.GUI库让调试变得易如反掌</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用ASCII效果"><span class="nav-number">11.</span> <span class="nav-text">使用ASCII效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">12.</span> <span class="nav-text">总结</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#下一章中我们会拓展本章的示例，你将学到更多threejs知识。"><span class="nav-number">12.0.1.</span> <span class="nav-text">下一章中我们会拓展本章的示例，你将学到更多threejs知识。</span></a></li></ol></li></ol></li></ol></div>
          
        </div>
        <div class="post-toc-indicator-bottom post-toc-indicator"></div>
      </div>
    

  </div>
</div>


      </div>
    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp;  2011 - 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">visgee</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $(".fancybox").fancybox();
    });
  </script>

  <script type="text/javascript">
  function hasMobileUA () {
    var nav = window.navigator;
    var ua = nav.userAgent;
    var pa = /iPad|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|Blazer|PSP|IEMobile|Symbian/g;

    return pa.test(ua);
  }

  function isDesktop () {
    return screen.width > 991 && !hasMobileUA();
  }

  function isTablet () {
    return screen.width < 992 && screen.width > 767 && hasMobileUA();
  }

  function isMobile () {
    return screen.width < 767 && hasMobileUA();
  }

  function escapeSelector (selector) {
    return selector.replace(/[!"$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g, "\\$&")
  }
</script>

  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" id="motion.global">
  $(document).ready(function () {
    var body = $('body');
    var isSidebarVisible = false;
    var sidebarToggle = $('.sidebar-toggle');
    var sidebarToggleLine1st = $('.sidebar-toggle-line-first')
    var sidebarToggleLine2nd = $('.sidebar-toggle-line-middle');
    var sidebarToggleLine3rd = $('.sidebar-toggle-line-last');
    var sidebar = $('.sidebar');

    var SIDEBAR_WIDTH = '320px';
    var SIDEBAR_DISPLAY_DURATION = 300;

    var sidebarToogleLineStatusInit = {width: '100%', opacity: 1, left: 0, rotateZ: 0, top: 0};

    var sidebarToggleLine1stStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine1stStatusArrow = {width: '50%', rotateZ: '-45deg', top: '2px'};
    var sidebarToogleLine1stStatusClose = {width: '100%', rotateZ: '-45deg', top: '5px'};

    var sidebarToggleLine2ndStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine2ndStatusArrow = {width: '90%'};
    var sidebarToogleLine2ndStatusClose = {opacity: 0};

    var sidebarToggleLine3rdStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine3rdStatusArrow = {width: '50%', rotateZ: '45deg', top: '-2px'};
    var sidebarToogleLine3rdStatusClose = {width: '100%', rotateZ: '45deg', top: '-5px'};

    LogoAndMenuMotion();
    sidebatToggleMotion();
    postsListMotion();
    backToTopMotion();


    $(document)
      .on('sidebar.isShowing', function () {
        isDesktop() && body.velocity(
          {paddingRight: SIDEBAR_WIDTH},
          SIDEBAR_DISPLAY_DURATION
        );
        sidebarContentMotion();
      })
      .on('sidebar.isHiding', function () {});

    function LogoAndMenuMotion() {
      $.Velocity.RunSequence([
        { e: $('.brand'), p: { opacity: 1 }, o: { duration: 100 } },
        { e: $('.logo'), p: { opacity: 1, top: 0 }, o: { duration: 50} },
        
        { e: $('.site-title'), p: { opacity: 1, top: 0 }, o: { duration: 200 } }
      ]);
      $('.menu-item').velocity('transition.slideDownIn', {display: null});
    }


    function backToTopMotion () {
      var b2top = $('.back-to-top');
      b2top.on('click', function () {
        body.velocity('scroll');
      });
    }

    function sidebarShowMotion () {

      sidebarToggleLine1st.velocity(sidebarToogleLine1stStatusClose);
      sidebarToggleLine2nd.velocity(sidebarToogleLine2ndStatusClose);
      sidebarToggleLine3rd.velocity(sidebarToogleLine3rdStatusClose);

      sidebar.velocity({width: SIDEBAR_WIDTH}, {
        display: 'block',
        duration: SIDEBAR_DISPLAY_DURATION,
        complete: function () {
          sidebar.addClass('sidebar-active');
          sidebar.trigger('sidebar.didShow');
        }
      });
      sidebar.trigger('sidebar.isShowing');
    }

    function sidebarHideMotion () {
      isDesktop() && body.velocity({paddingRight: 0});
      sidebar.velocity('reverse');

      sidebarToggleLine1st.velocity(sidebarToggleLine1stStatusInit);
      sidebarToggleLine2nd.velocity(sidebarToggleLine2ndStatusInit);
      sidebarToggleLine3rd.velocity(sidebarToggleLine3rdStatusInit);

      sidebar.removeClass('sidebar-active');
      sidebar.trigger('sidebar.isHiding');
    };

    function sidebarContentMotion () {
      $('.sidebar .motion-element').velocity(
        'transition.slideRightIn',
        {stagger: 50, drag: true}
      );
    }

    function postsListMotion () {
      var postMotionOptions = window.postMotionOptions || {stagger: 300, drag: true};
      $('.post').velocity('transition.slideDownIn', postMotionOptions);
    }

    function sidebatToggleMotion () {
      sidebarToggle.on('click', function () {
        isSidebarVisible ? sidebarHideMotion() : sidebarShowMotion();
        isSidebarVisible = !isSidebarVisible;
      });

      sidebarToggle.hover(function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusArrow);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusArrow);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusArrow);
      }, function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusInit);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusInit);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusInit);
      });
    }
  });

</script>





  
  
<script type="text/javascript" id="bootstrap.scrollspy.custom">
  /* ========================================================================
  * Bootstrap: scrollspy.js v3.3.2
  * http://getbootstrap.com/javascript/#scrollspy
  * ========================================================================
  * Copyright 2011-2015 Twitter, Inc.
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
  * ======================================================================== */

  /**
   * Custom by iissnan
   *
   * - Add a `clear.bs.scrollspy` event.
   * - Esacpe targets selector.
   */


  +function ($) {
    'use strict';

    // SCROLLSPY CLASS DEFINITION
    // ==========================

    function ScrollSpy(element, options) {
      this.$body          = $(document.body)
      this.$scrollElement = $(element).is(document.body) ? $(window) : $(element)
      this.options        = $.extend({}, ScrollSpy.DEFAULTS, options)
      this.selector       = (this.options.target || '') + ' .nav li > a'
      this.offsets        = []
      this.targets        = []
      this.activeTarget   = null
      this.scrollHeight   = 0

      this.$scrollElement.on('scroll.bs.scrollspy', $.proxy(this.process, this))
      this.refresh()
      this.process()
    }

    ScrollSpy.VERSION  = '3.3.2'

    ScrollSpy.DEFAULTS = {
      offset: 10
    }

    ScrollSpy.prototype.getScrollHeight = function () {
      return this.$scrollElement[0].scrollHeight || Math.max(this.$body[0].scrollHeight, document.documentElement.scrollHeight)
    }

    ScrollSpy.prototype.refresh = function () {
      var that          = this
      var offsetMethod  = 'offset'
      var offsetBase    = 0

      this.offsets      = []
      this.targets      = []
      this.scrollHeight = this.getScrollHeight()

      if (!$.isWindow(this.$scrollElement[0])) {
        offsetMethod = 'position'
        offsetBase   = this.$scrollElement.scrollTop()
      }

      this.$body
        .find(this.selector)
        .map(function () {
          var $el   = $(this)
          var href  = $el.data('target') || $el.attr('href')
          var $href = /^#./.test(href) && $(escapeSelector(href)) // Need to escape selector.

          return ($href
            && $href.length
            && $href.is(':visible')
            && [[$href[offsetMethod]().top + offsetBase, href]]) || null
        })
        .sort(function (a, b) { return a[0] - b[0] })
        .each(function () {
          that.offsets.push(this[0])
          that.targets.push(this[1])
        })


    }

    ScrollSpy.prototype.process = function () {
      var scrollTop    = this.$scrollElement.scrollTop() + this.options.offset
      var scrollHeight = this.getScrollHeight()
      var maxScroll    = this.options.offset + scrollHeight - this.$scrollElement.height()
      var offsets      = this.offsets
      var targets      = this.targets
      var activeTarget = this.activeTarget
      var i

      if (this.scrollHeight != scrollHeight) {
        this.refresh()
      }

      if (scrollTop >= maxScroll) {
        return activeTarget != (i = targets[targets.length - 1]) && this.activate(i)
      }

      if (activeTarget && scrollTop < offsets[0]) {
        $(this.selector).trigger('clear.bs.scrollspy')  // Add a custom event.
        this.activeTarget = null
        return this.clear()
      }

      for (i = offsets.length; i--;) {
        activeTarget != targets[i]
          && scrollTop >= offsets[i]
          && (!offsets[i + 1] || scrollTop <= offsets[i + 1])
          && this.activate(targets[i])
      }
    }

    ScrollSpy.prototype.activate = function (target) {
      this.activeTarget = target

      this.clear()

      var selector = this.selector +
        '[data-target="' + target + '"],' +
        this.selector + '[href="' + target + '"]'

      var active = $(selector)
        .parents('li')
        .addClass('active')

      if (active.parent('.dropdown-menu').length) {
        active = active
          .closest('li.dropdown')
          .addClass('active')
      }

      active.trigger('activate.bs.scrollspy')
    }

    ScrollSpy.prototype.clear = function () {
      $(this.selector)
        .parentsUntil(this.options.target, '.active')
        .removeClass('active')
    }


    // SCROLLSPY PLUGIN DEFINITION
    // ===========================

    function Plugin(option) {
      return this.each(function () {
        var $this   = $(this)
        var data    = $this.data('bs.scrollspy')
        var options = typeof option == 'object' && option

        if (!data) $this.data('bs.scrollspy', (data = new ScrollSpy(this, options)))
        if (typeof option == 'string') data[option]()
      })
    }

    var old = $.fn.scrollspy

    $.fn.scrollspy             = Plugin
    $.fn.scrollspy.Constructor = ScrollSpy


    // SCROLLSPY NO CONFLICT
    // =====================

    $.fn.scrollspy.noConflict = function () {
      $.fn.scrollspy = old
      return this
    }


    // SCROLLSPY DATA-API
    // ==================

    $(window).on('load.bs.scrollspy.data-api', function () {
      $('[data-spy="scroll"]').each(function () {
        var $spy = $(this)
        Plugin.call($spy, $spy.data())
      })
    })

  }(jQuery);
</script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var $sidebarInner = $('.sidebar-inner');
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.didShow', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;
          var self = this;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      $(indicator).velocity('stop').velocity({
        opacity: action === 'show' ? 0.4 : 0
      }, { duration: 100 });
    }

  });
</script>


  <script type="text/javascript" id="sidebar.nav">
    $(document).ready(function () {
      var html = $('html');

      $('.sidebar-nav li').on('click', function () {
        var item = $(this);
        var activeTabClassName = 'sidebar-nav-active';
        var activePanelClassName = 'sidebar-panel-active';
        if (item.hasClass(activeTabClassName)) {
          return;
        }

        var currentTarget = $('.' + activePanelClassName);
        var target = $('.' + item.data('target'));

        currentTarget.velocity('transition.slideUpOut', 200, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', 200)
            .addClass(activePanelClassName);
        });

        item.siblings().removeClass(activeTabClassName);
        item.addClass(activeTabClassName);
      });

      $('.post-toc a').on('click', function (e) {
        e.preventDefault();
        var offset = $(escapeSelector(this.getAttribute('href'))).offset().top;
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        });
      });

      // Expand sidebar on post detail page by default, when post has a toc.
      var $tocContent = $('.post-toc-content');
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0 && isDesktop()) {
        setTimeout(function () {
          $('.sidebar-toggle').trigger('click');
        }, 800);
      }
    });
  </script>




  

  
  

  


  
</body>
</html>
